- name: Zabbix agent Playbook
  hosts: springhost

  tasks:
  - name: Ensure zabbix repo installed
    yum: name=http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm
    become: yes
    become_user: root

  - name: Ensure zabbix packages installed
    yum: name={{ item }} state=installed
    with_items:
      - zabbix-agent
      - zabbix-java-gateway
    become: yes
    become_user: root

  - name: Ensure zabbix-agent config exists
    file: src=./zabbix/zabbix_agentd.conf dest=/etc/zabbix/zabbix_agentd.conf
    become: yes
    become_user: root

  - name: Ensure zabbix-agent config exists
    file: src=./docker2/zabbix/zabbix_java_gateway.conf  dest=/etc/zabbix/zabbix_java_gateway.conf 
    become: yes
    become_user: root

  - name: Ensure zabbix agent is running
    become: yes
    become_user: root
    service: name={{ item }} state=started enabled=yes
    with_items:
      - zabbix-agent
      - zabbix-java-gateway
