- name: Zabbix agent Playbook
  hosts: springhost

  tasks:
  - name: Ensure zabbix repo installed
    yum: name=http://repo.zabbix.com/zabbix/3.2/rhel/7/x86_64/zabbix-release-3.2-1.el7.noarch.rpm

  - name: Ensure zabbix packages installed
    yum: name={{ item }} state=installed
    with_items:
      - zabbix-agent
      - zabbix-java-gateway

  - name: Ensure zabbix-agent config exists
    file: src=/home/student/docker2/zabbix/zabbix_agentd.conf dest=/etc/zabbix/zabbix_agentd.conf state=touch

  - name: Ensure zabbix-agent config exists
    file: src=/home/student/docker2/zabbix/zabbix_java_gateway.conf  dest=/etc/zabbix/zabbix_java_gateway.conf state=touch

  - name: Ensure zabbix-agent config exists
    file: src=/home/student/docker2/zabbix/zabbix_server.conf  dest=/etc/zabbix/zabbix_server.conf state=touch

  - name: Ensure zabbix agent is running
    service: name={{ item }} state=started enabled=yes
    with_items:
      - zabbix-agent
      - zabbix-java-gateway
